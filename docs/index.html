<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Choret: Functional Choreographic Programming for Racket</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Choret:<span class="mywbr"> &nbsp;</span> Functional Choreographic Programming for Racket</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Getting_.Started%29" class="tocviewlink" data-pltdoc="x">Getting Started</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.What_is_.Choreographic_.Programming_%29" class="tocviewlink" data-pltdoc="x">What is Choreographic Programming?</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.Choret_.Forms%29" class="tocviewlink" data-pltdoc="x">Choret Forms</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Future_.Work%29" class="tocviewlink" data-pltdoc="x">Future Work</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Choret__.Functional_.Choreographic_.Programming_for_.Racket%29" class="tocsubseclink" data-pltdoc="x">Choret:<span class="mywbr"> &nbsp;</span> Functional Choreographic Programming for Racket</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Getting_.Started%29" class="tocsubseclink" data-pltdoc="x">Getting Started</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.Requirements_to_.Run%29" class="tocsubseclink" data-pltdoc="x">Requirements to Run</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._.Installing_.Choret_as_a_.Library%29" class="tocsubseclink" data-pltdoc="x">Installing Choret as a Library</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.What_is_.Choreographic_.Programming_%29" class="tocsubseclink" data-pltdoc="x">What is Choreographic Programming?</a></td></tr><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.The_.Bookseller_.Example_in_.Racket%29" class="tocsubseclink" data-pltdoc="x">The Bookseller Example in Racket</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.The_.Bookseller_.Example_in_.Choret%29" class="tocsubseclink" data-pltdoc="x">The Bookseller Example in Choret</a></td></tr><tr><td><span class="tocsublinknumber">2.3<tt>&nbsp;</tt></span><a href="#%28part._.Conditional_.Expressions%29" class="tocsubseclink" data-pltdoc="x">Conditional Expressions</a></td></tr><tr><td><span class="tocsublinknumber">2.4<tt>&nbsp;</tt></span><a href="#%28part._.Selection_and_.Knowledge_of_.Choice%29" class="tocsubseclink" data-pltdoc="x">Selection and Knowledge of Choice</a></td></tr><tr><td><span class="tocsublinknumber">2.5<tt>&nbsp;</tt></span><a href="#%28part._.Simplified_.Bookseller_.Example_in_.Choret%29" class="tocsubseclink" data-pltdoc="x">Simplified Bookseller Example in Choret</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.Choret_.Forms%29" class="tocsubseclink" data-pltdoc="x">Choret Forms</a></td></tr><tr><td><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._chor%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">chor</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">at</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">~&gt;</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">if</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">sel~&gt;</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._set%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">set!</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._let%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">let</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._lambda%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">lambda</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Future_.Work%29" class="tocsubseclink" data-pltdoc="x">Future Work</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">8.13</span></div><h2 class="heading"><a name="(part._.Choret__.Functional_.Choreographic_.Programming_for_.Racket)"></a>Choret: Functional Choreographic Programming for Racket<span class="button-group"><a href="#(part._.Choret__.Functional_.Choreographic_.Programming_for_.Racket)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h2><p>Choret is an in-development Racket library which allows for choreographic programming. It implements an untyped language based off of <span style="font-style: italic">Pirouette</span>, a functional choreographic programming language developed by Andrew K. Hirsch (my research advisor) and Deepak Garg. Their paper, <span style="font-style: italic">Pirouette: Higher-Order Typed Functional Choreographies</span>, can be found here: <a href="https://dl.acm.org/doi/10.1145/3498684"><span class="url">https://dl.acm.org/doi/10.1145/3498684</span></a>.</p><h3 class="heading">1<tt>&nbsp;</tt><a name="(part._.Getting_.Started)"></a>Getting Started<span class="button-group"><a href="#(part._.Getting_.Started)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><h4 class="heading">1.1<tt>&nbsp;</tt><a name="(part._.Requirements_to_.Run)"></a>Requirements to Run<span class="button-group"><a href="#(part._.Requirements_to_.Run)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p><div class="SIntrapara">Currently Choret&rsquo;s unit tests have been tested and passed on Racket versions 6.6, 6.12, 7.0, 7.4, 7.9, 8.0, 8.2, and 8.14. Choret may work as intended on other versions of Racket as well, although, if you are experiencing issues on a different version of Racket, then you might want to consider using the the <span class="stt">cross</span> package: <a href="https://docs.racket-lang.org/raco-cross/index.html"><span class="url">https://docs.racket-lang.org/raco-cross/index.html</span></a> with the </div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">--version</span></p></td></tr></table></div><div class="SIntrapara"> flag or consider installing a newer version of Racket. NOTE: Choret is not guaranteed to remain compatible with the versions of Racket listed above as this library is experimental.</div></p><h4 class="heading">1.2<tt>&nbsp;</tt><a name="(part._.Installing_.Choret_as_a_.Library)"></a>Installing Choret as a Library<span class="button-group"><a href="#(part._.Installing_.Choret_as_a_.Library)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p><div class="SIntrapara">As of right now Choret is not yet availible via the Racket Package Index. Instead Choret needs to be installed manually, which is not <span style="font-style: italic">too</span> difficult. First clone the Choret repository: <a href="https://github.com/Foundations-of-Decentralization-Group/choret"><span class="url">https://github.com/Foundations-of-Decentralization-Group/choret</span></a>. Once the repository has been cloned, say to a directory named "choret", there should be another sub-directory named "choret"; change directory (<span class="stt">cd</span>) into that directory and run the following command:
</div><div class="SIntrapara"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">raco pkg install</span></div></p><h3 class="heading">2<tt>&nbsp;</tt><a name="(part._.What_is_.Choreographic_.Programming_)"></a>What is Choreographic Programming?<span class="button-group"><a href="#(part._.What_is_.Choreographic_.Programming_)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p>In a traditional system with multiple <span style="font-style: italic">locations</span> (threads, processes, etc.) interacting with each other, the programmer has to carefully write multiple independent programs while also avoiding things such as deadlock or livelock. In particular, encoding a pattern of sends and recieves between locations in a system can be error prone since it is relatively easy to write mismatched send and recieve actions between two separately maintained programs; it is entirely up to the programmer to maintain the state and invariants of the entire system.</p><p>Choreographic programming aims to solve this problem by allowing programmers to give a "global" description of the program. In other words, the programmer writes a single program that describes the logic of the system/protocol as a whole, explicity specifying the when data needs to be transferred from one participant to another.</p><h4 class="heading">2.1<tt>&nbsp;</tt><a name="(part._.The_.Bookseller_.Example_in_.Racket)"></a>The Bookseller Example in Racket<span class="button-group"><a href="#(part._.The_.Bookseller_.Example_in_.Racket)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p><div class="SIntrapara">Consider the quintessential example of an online bookseller. In order to sell a
book, the following should happen between a buyer and the seller:
</div><div class="SIntrapara"><ol><li><p>The buyer sends the title of a book they would like to buy to the
seller.</p></li><li><p>The seller looks up the book title and retrieves the cost of the book;
the price is communicated back to the buyer.</p></li><li><p>The buyer tells the seller whether or not they will buy the book.</p></li><li><p>If the buyer says they will buy the book, the seller completes the
transaction by giving the buyer a shipping date.</p></li></ol></div></p><p>Seems simple enough, this is what such a program might look like in Racket, with the matching sends and recieves commented with a number in square brackets (using threads and channels for simplicity):</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-channel</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Buyer thread</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">thread</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alice in Wonderland"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">budget</span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">channel-put</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[1]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">price</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">channel-get</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[2]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;</span><span class="hspace">&nbsp;</span><span class="RktSym">price</span><span class="hspace">&nbsp;</span><span class="RktSym">budget</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">channel-put</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">buy-book</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[3]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">date</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">channel-get</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span><span class="hspace">&nbsp;</span><span class="RktVal">"My book should arrive on ~a!~n"</span><span class="hspace">&nbsp;</span><span class="RktSym">date</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[4]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span><span class="hspace">&nbsp;</span><span class="RktVal">"Nevermind!~n"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Seller thread</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">thread</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">price-catalog</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-hash</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">"Alice in Wonderland"</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">25</span><span class="RktVal">]</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">channel-get</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[1]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">price</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">hash-ref</span><span class="hspace">&nbsp;</span><span class="RktSym">price-catalog</span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">channel-put</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="hspace">&nbsp;</span><span class="RktSym">price</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[2]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">will-buy</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">channel-get</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[3]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="hspace">&nbsp;</span><span class="RktSym">will-buy</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">buy-book</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">channel-put</span><span class="hspace">&nbsp;</span><span class="RktSym">ch</span><span class="hspace">&nbsp;</span><span class="RktVal">"January 1, 1970"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[4]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span><span class="hspace">&nbsp;</span><span class="RktVal">"Let me know if you change your mind!~n"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">thread-wait</span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">thread-wait</span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="RktPn">)</span></td></tr></table></blockquote><p><div class="SIntrapara">This seems correct, and given that the buyer&rsquo;s budget (20) is lower than the cost of the book (25) the expected result of this program would be:
</div><div class="SIntrapara"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Nevermind!</span></div><div class="SIntrapara"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Let me know if you change your mind!</span></div><div class="SIntrapara">However the actual output of
this program is:
</div><div class="SIntrapara"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Nevermind!</span></div><div class="SIntrapara">What&rsquo;s the problem? Well, the buyer needs to let the seller know if they are going to buy the book, but in the buyer thread code, the buyer only communicates the <span style="font-style: italic">knowledge of this choice</span> if decides to buy the book; when the buyer does not buy the book it leaves the seller deadlocked waiting on the buyer&rsquo;s decision.</div></p><p>Even though this may be a trivial example, it emphasizes the importance of correctly matching sends and recieves; in much more complicated programs it may be much harder to correctly do this by hand.</p><h4 class="heading">2.2<tt>&nbsp;</tt><a name="(part._.The_.Bookseller_.Example_in_.Choret)"></a>The Bookseller Example in Choret<span class="button-group"><a href="#(part._.The_.Bookseller_.Example_in_.Choret)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>If manually matching sends and recieves is error prone, what can be done differently?</p><p>Looking back in the last section, the bookseller system was described as a series of steps:</p><ol><li><p>The buyer sends the title of a book they would like to buy to the
seller.</p></li><li><p>The seller looks up the book title and retrieves the cost of the book;
the price is communicated back to the buyer.</p></li><li><p>The buyer tells the seller whether or not they will buy the book.</p></li><li><p>If the buyer says they will buy the book, the seller completes the
transaction by giving the buyer a shipping date.</p></li></ol><p>This English prose description already describes what the system should do in a global manner. This can be translated into pseudo-code:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">buyer.title ~&gt; seller.title</span></p></td></tr><tr><td><p><span class="stt">seller.catalog(title) ~&gt; buyer.price</span></p></td></tr><tr><td><p><span class="stt">if buyer.price &lt; buyer.budget then</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">buyer informs seller "I'll buy the book"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">seller.getDate(title) ~&gt; buyer.date</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">buyer.print(date)</span></p></td></tr><tr><td><p><span class="stt">else</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">buyer informs seller "I won't buy the book"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">seller.print("Let me know if you change your mind!")</span></p></td></tr><tr><td><p><span class="stt">endif</span></p></td></tr></table></p><p>The above pseudo-code basically describes a choreographic program! Finally here is the bookseller program written in Choret:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">require</span><span class="hspace">&nbsp;</span><span class="RktSym">choret</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._chor%29%29" class="RktStxLink" data-pltdoc="x">chor</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alice in Wonderland"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">budget</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktVal">30</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktSym">price-catalog</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-hash</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">"Alice in Wonderland"</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">25</span><span class="RktVal">]</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">[1]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktSym">price</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">hash-ref</span><span class="hspace">&nbsp;</span><span class="RktSym">price-catalog</span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">price</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktSym">price</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;</span><span class="hspace">&nbsp;</span><span class="RktSym">price</span><span class="hspace">&nbsp;</span><span class="RktSym">budget</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">buy-book</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktSym">date</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktVal">"January 1, 1970"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">date</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktSym">date</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"My book should arrive on ~a!~n"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">date</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">reject-book</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">begin</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span><span class="hspace">&nbsp;</span><span class="RktVal">"Nevermind!~n"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"Let me know if you change your mind!~n"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This is a somewhat verbose piece of code so here is a breakdown of what is going on:</p><p>First, there are these <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="stt"> </span><span class="RktSym">LOCATION</span><span class="stt"> </span><span class="RktSym">ID</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">EXPR</span><span class="RktPn">)</span> forms which define a variable which is located at <span class="RktSym">LOCATION</span>; <span class="RktSym">EXPR</span> can be any Choret form which evaluates to a value that is also located at <span class="RktSym">LOCATION</span>.</p><p>There are also communication primitives of the form <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="stt"> </span><span class="RktSym">SENDER</span><span class="stt"> </span><span class="RktSym">LOCAL-EXPR</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">RECIEVER</span><span class="RktPn">)</span>, these forms evaluate <span class="RktSym">LOCAL-EXPR</span> at the location <span class="RktSym">SENDER</span> and produce a value located at <span class="RktSym">RECIEVER</span>; the underlying implementation executes a <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span> form by sending the result of evaluating <span class="RktSym">LOCAL-EXPR</span> and sending the value from <span class="RktSym">SENDER</span> to <span class="RktSym">RECIEVER</span>.</p><p>"at" expressions, which have the form <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="stt"> </span><span class="RktSym">LOCATION</span><span class="stt"> </span><span class="RktSym">LOCAL-EXPR</span><span class="RktPn">)</span> evaluate <span class="RktSym">LOCAL-EXPR</span> as a normal Racket expression located at <span class="RktSym">LOCATION</span>.</p><p>The forms that comprise the first half of the choreography are fairly straightforward, however, things get a little more involved when handling conditionals.</p><h4 class="heading">2.3<tt>&nbsp;</tt><a name="(part._.Conditional_.Expressions)"></a>Conditional Expressions<span class="button-group"><a href="#(part._.Conditional_.Expressions)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>What makes conditional branching difficult in choreographic programming? It helps to think about the code that has to be generated for each location, which is referred to as the <span style="font-style: italic">projection</span> of each location.</p><p><div class="SIntrapara">Take for example the form
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara">The projection for location <span class="RktSym">L1</span> is straightforward:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">send</span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">send</span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara">However the projection for <span class="RktSym">L2</span> is trickier. In this case one may notice that <span class="RktSym">L2</span>&rsquo;s projection for each branch is the same:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktSym">???</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">recieve</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">recieve</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara">These subforms for each branch are the same, and thus can be combinded into a single form:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">recieve</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span></p></blockquote></div></p><p>This combining of the branches of the <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span> form is known as <span style="font-style: italic">merging</span>. In fact whenever an <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span> expresssion is projected for locations other than the one in the guard expression (in this case <span class="RktSym">L1</span>), the two branches are merged together. Merging is strictly something that is performed at compile time.</p><p><div class="SIntrapara">That is all well and good, but what happens if one tries to project the following instead:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">for <span class="RktSym">L2</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktSym">???</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">send</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">send</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>There are two problems here. First, since <span class="RktSym">L2</span> now needs to do something different in each branch, there needs to be some way to communicate the knowledge of <span class="RktSym">L1</span>&rsquo;s decision to <span class="RktSym">L2</span>. Second, <span class="RktSym">L2</span>&rsquo;s projections of the branches cannot be merged together as they are not identical (the <span class="RktVal">5</span> and <span class="RktVal">10</span> do not match). In the next section, <span style="font-style: italic">slections</span> will be used to solve both of these problems.</p><h4 class="heading">2.4<tt>&nbsp;</tt><a name="(part._.Selection_and_.Knowledge_of_.Choice)"></a>Selection and Knowledge of Choice<span class="button-group"><a href="#(part._.Selection_and_.Knowledge_of_.Choice)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>The dependency between locations about which branch should be taken is known as <span style="font-style: italic">Knowledge of Choice</span>. To comminicate Knowledge of Choice a message from the deciding location (such as <span class="RktSym">L1</span> in the example above) to other dependent locations needs to be sent.</p><p>In the previous example, it is trivial to understand that <span class="RktSym">L1</span> should send <span class="RktSym">L2</span> a message about which branch to take. So why not have the compiler just automatically do this for the programmer? A problem arises in programs with more locations; if the compiler does this naively, then it has to send a message to every location, even if not all locations need to know the decision at <span class="RktSym">L1</span>; otherwise the compiler needs to automatically infer which locations need Knowledge of Choice, which can be difficult to do.</p><p>Instead of doing either of those things, Choret requires the programmer to explicitly state Knowledge of Choice where appropriate. This is accomplished using the <span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span><span class="stt"> </span><span class="RktSym">SENDER</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktSym">RECIEVER</span><span class="stt"> </span><span class="RktSym">LABEL</span><span class="stt"> </span><span class="RktSym">EXPR</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktSym">...</span><span class="RktPn">)</span> form to perform what is known as a <span style="font-style: italic">selection</span>. The selection form can be thought of as sending a message from <span class="RktSym">SENDER</span>, which should be the location which actually determines whether to take the branch, to a multiple recieving locations, where for each <span class="RktSym">RECIEVER</span>, <span class="RktSym">LABEL</span> is a unique value that represents the branch to be taken and <span class="RktSym">EXPR</span> is a Choret expression to be evaluated for that particular branch.</p><p>The example from the last section can be updated to use selections as appropriate:</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">equal</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">not-equal</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">which when projected for <span class="RktSym">L2</span> would be something like:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">merge</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">equal</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">not-equal</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">which would be merged into:
which when projected for <span class="RktSym">L2</span> would be something like:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">equal</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">not-equal</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">which would expand into:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">L1-decision</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">recieve</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cond</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="hspace">&nbsp;</span><span class="RktSym">L1-decision</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">equal</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="hspace">&nbsp;</span><span class="RktSym">L1-decision</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">not-equal</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L2</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>As seen above, selections are also important for merging. In fact the case where two selections (<span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span> forms) are being merged together is actually a special case; the set labels between the two selections are compared and the sub-expressions corresponding to unique labels are simply left alone to be projected as-is; if two labels are shared between the selections however, the sub-expressions corresponding to those labels are recursively merged together.</p><p>In the example above, since the selections in either branch do not match, they do not need to be merged together.</p><p>It should be noted that the reason why unique labels between selections do not need to be merged is because the <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span> form also generates the code needed to communicate the appropriate <span style="font-style: italic">Knowledge of Choice</span>; merging is only needed in the absence of <span style="font-style: italic">Knowledge of Choice</span>.</p><h4 class="heading">2.5<tt>&nbsp;</tt><a name="(part._.Simplified_.Bookseller_.Example_in_.Choret)"></a>Simplified Bookseller Example in Choret<span class="button-group"><a href="#(part._.Simplified_.Bookseller_.Example_in_.Choret)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>The previous bookseller example in Choret was a bit verbose and repetitive, but this can be improved by using more of the forms and idioms availible in Choret:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._chor%29%29" class="RktStxLink" data-pltdoc="x">chor</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alice in Wonderland"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">budget</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktVal">30</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktSym">price-catalog</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-hash</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">[</span><span class="RktVal">"Alice in Wonderland"</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">25</span><span class="RktVal">]</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">price</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">hash-ref</span><span class="hspace">&nbsp;</span><span class="RktSym">price-catalog</span><span class="hspace">&nbsp;</span><span class="RktSym">book-title</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&lt;</span><span class="hspace">&nbsp;</span><span class="RktSym">price</span><span class="hspace">&nbsp;</span><span class="RktSym">budget</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">buy-book</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktSym">date</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktVal">"January 1, 1970"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"My book should arrive on ~a!~n"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">date</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">seller</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">reject-book</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">begin</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">buyer</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span><span class="hspace">&nbsp;</span><span class="RktVal">"Nevermind!~n"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktSym">seller</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"Let me know if you change your mind!~n"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><h3 class="heading">3<tt>&nbsp;</tt><a name="(part._.Choret_.Forms)"></a><a name="(mod-path._choret)"></a>Choret Forms<span class="button-group"><a href="#(part._.Choret_.Forms)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span><span class="stt"> </span><a href="#%28mod-path._choret%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">choret</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/choret" title="Install this package using `raco pkg install choret`"><span class="stt">choret</span></a></span></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._choret/main..rkt)._chor))"></a><span title="Provided from: choret | Package: choret"><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._chor%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">chor</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">location</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">global-body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...+</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Entry point for executing Choret programs and using Choret forms. The other
Choret forms described below only work inside the body of this macro; otherwise
they either are undefined (raise a syntax error) or have the meaning of their
regular Racket counterpart (e.g. <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span>, <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span>, etc.). The
list of locations <span class="RktVar">location</span><span class="stt"> </span><span class="RktMeta">...</span> defines the set of all locations that
participate in the choreography.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._choret/main..rkt)._at))"></a><span title="Provided from: choret | Package: choret"><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">at</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">location</span><span class="hspace">&nbsp;</span><span class="RktVar">local-expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Evaluates <span class="RktVar">local-expr</span> at the location <span class="RktVar">location</span>. Not to be
confused with the use of at forms used in binding locations such as in
<span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span>, <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span>, and <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span>, which expect an identifier.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._choret/main..rkt)._~7e~3e))"></a><span title="Provided from: choret | Package: choret"><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">~&gt;</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktVar">A</span><span class="hspace">&nbsp;</span><span class="RktVar">local-expr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">B</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Evaluates <span class="RktVar">local-expr</span> at location <span class="RktVar">A</span>, and returns the value of
<span class="RktVar">local-expr</span> located at location <span class="RktVar">B</span>. Essentially, <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span>
synchronously sends a value from one location to another.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._choret/main..rkt)._if))"></a><span title="Provided from: choret | Package: choret"><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">if</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktVar">location</span><span class="hspace">&nbsp;</span><span class="RktVar">test-local-expr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">then-global-expr</span><span class="hspace">&nbsp;</span><span class="RktVar">else-global-expr</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Evaluates <span class="RktVar">test-local-expr</span> at <span class="RktVar">location</span>, which is the "guard"
location. If a value other than <span class="RktVal">#f</span> is produced the
<span class="RktVar">then-global-expr</span> is evaluated and becomes the result ofthe <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span>
form. Otherwise <span class="RktVar">else-global-expr</span> is evaluated and becomes the result
of the <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span> form. Expressions involving locations other than the "guard"
location must either be identical in each branch of the <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span> form, or
must reside in a <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">sel~&gt;</a></span> form which mentions it as a reciever.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._choret/main..rkt)._sel~7e~3e))"></a><span title="Provided from: choret | Package: choret"><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._sel~7e~3e%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">sel~&gt;</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">sender</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVar">reciever</span><span class="hspace">&nbsp;</span><span class="RktVar">label</span><span class="hspace">&nbsp;</span><span class="RktVar">global-expr</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Communicates knowledge of choice from the location <span class="RktVar">sender</span> to each
<span class="RktVar">reciever</span>. <span class="RktVar">label</span> is a symbol that represents which branch of
execution an <span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span> branch takes.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._choret/main..rkt)._define))"></a><span title="Provided from: choret | Package: choret"><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktVar">location</span><span class="hspace">&nbsp;</span><span class="RktVar">local-id</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">global-expr</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._define%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktVar">global-id</span><span class="hspace">&nbsp;</span><span class="RktVar">global-expr</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><blockquote class="SubFlow"><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">global-expr</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">any</span></td></tr></table><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">global-expr</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym">located-at?</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Evaluates <span class="RktVar">global-expr</span> and either binds it to the choreographic
variable <span class="RktVar">global-id</span> or binds it to the local variable
<span class="RktVar">local-id</span> located at <span class="RktVar">location</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._choret/main..rkt)._set!))"></a><span title="Provided from: choret | Package: choret"><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._set%21%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">set!</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktVar">location</span><span class="hspace">&nbsp;</span><span class="RktVar">local-id</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">global-expr</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._set%21%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">set!</a></span><span class="hspace">&nbsp;</span><span class="RktVar">global-id</span><span class="hspace">&nbsp;</span><span class="RktVar">global-expr</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Sets/mutates the value of either a local variable <span class="RktVar">local-id</span> located at
<span class="RktVar">location</span> or a choreographic variable <span class="RktVar">global-id</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._choret/main..rkt)._let))"></a><span title="Provided from: choret | Package: choret"><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._let%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">let</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktVar">global-expr</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">global-body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...+</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">id</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktVar">location</span><span class="hspace">&nbsp;</span><span class="RktVar">local-id</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">global-id</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Evaluates the <span class="RktVar">global-expr</span>s left-to-right, where each expression
evaluates to a located value, binding the result of each to the identifier of
its corresponding <span class="RktVar">id</span>. <span class="RktVar">id</span> may either be a local variable or a
choreographic variable.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._choret/main..rkt)._lambda))"></a><span title="Provided from: choret | Package: choret"><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._lambda%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">lambda</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">binding-form</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">global-body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...+</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">binding-form</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">global-id</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._choret%2Fmain..rkt%29._at%29%29" class="RktStxLink" data-pltdoc="x">at</a></span><span class="hspace">&nbsp;</span><span class="RktVar">location</span><span class="hspace">&nbsp;</span><span class="RktVar">local-id</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Creates a choreographic function which accepts zero or more choreographic
values. Each <span class="RktVar">binding-form</span> is either a located <span class="RktVar">local-id</span>, which
represents an argument which expects a value located at <span class="RktVar">location</span>, or a
<span class="RktVar">global-id</span>, which is a choreographic variable.</div></p><h3 class="heading">4<tt>&nbsp;</tt><a name="(part._.Future_.Work)"></a>Future Work<span class="button-group"><a href="#(part._.Future_.Work)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p>Being an experimental library, there are still many things that could be added and/or ammended to improve Choret:</p><ul><li><p>A type system for tracking and checking located-types and choreographic function types</p></li><li><p>Implement Location Polymorphism</p></li><li><p>Prohibit choreographic variables from being used directly in local expressions</p></li><li><p>More unit tests and measurement of code coverage</p></li><li><p>Better logging functionality</p></li><li><p>Better error messages when projecting code</p></li><li><p>Wrap all choreographic values with some kind of "chor-value" struct to provide better runtime errors (and perhaps other functionality)</p></li><li><p>Provide Choret as a proper "#lang" rather than just a library</p></li><li><p>Allow Choret to create module level definitions</p></li><li><p>Lift more forms from Racket into Choret</p></li><li><p>Integrate Choret with Racket Places</p></li><li><p>Implement a library of convenience functions and macros for syntactic sugar for Choret</p></li><li><p>Improve the underlying system of macros in "threads-network.rkt" which helps with implementing locations as Racket threads with synchronous channels</p></li></ul></div></div><div id="contextindicator">&nbsp;</div></body></html>